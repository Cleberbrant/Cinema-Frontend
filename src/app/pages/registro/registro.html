<div class="registro-container">
  <div class="registro-card">
    <div class="registro-header">
      <mat-icon class="registro-icon">person_add</mat-icon>
      <h1>Criar Conta</h1>
      <p>Cadastre-se para comprar ingressos</p>
    </div>

    <form
      [formGroup]="registroForm"
      (ngSubmit)="onSubmit()"
      class="registro-form"
    >
      <!-- Dados Pessoais -->
      <div class="form-section">
        <h3>Dados Pessoais</h3>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nome Completo</mat-label>
          <input
            matInput
            formControlName="nome"
            placeholder="Digite seu nome completo"
          />
          <mat-icon matSuffix>person</mat-icon>
          @if (registroForm.get('nome')?.hasError('required') &&
          registroForm.get('nome')?.touched) {
          <mat-error>Nome é obrigatório</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Data de Nascimento</mat-label>
          <input matInput type="date" formControlName="dataNascimento" />
          <mat-icon matSuffix>calendar_today</mat-icon>
          @if (registroForm.get('dataNascimento')?.hasError('required') &&
          registroForm.get('dataNascimento')?.touched) {
          <mat-error>Data de nascimento é obrigatória</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>CPF</mat-label>
          <input
            matInput
            formControlName="cpf"
            placeholder="000.000.000-00"
            mask="000.000.000-00"
          />
          <mat-icon matSuffix>badge</mat-icon>
          @if (registroForm.get('cpf')?.hasError('required') &&
          registroForm.get('cpf')?.touched) {
          <mat-error>CPF é obrigatório</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Dados de Acesso -->
      <div class="form-section">
        <h3>Dados de Acesso</h3>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>E-mail</mat-label>
          <input
            matInput
            type="email"
            formControlName="email"
            placeholder="seu@email.com"
          />
          <mat-icon matSuffix>email</mat-icon>
          @if (registroForm.get('email')?.hasError('required') &&
          registroForm.get('email')?.touched) {
          <mat-error>E-mail é obrigatório</mat-error>
          } @if (registroForm.get('email')?.hasError('email') &&
          registroForm.get('email')?.touched) {
          <mat-error>E-mail inválido</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Senha</mat-label>
          <input
            matInput
            [type]="hidePassword() ? 'password' : 'text'"
            formControlName="password"
            placeholder="Digite sua senha"
          />
          <button
            mat-icon-button
            matSuffix
            (click)="hidePassword.set(!hidePassword())"
            type="button"
          >
            <mat-icon>{{
              hidePassword() ? "visibility_off" : "visibility"
            }}</mat-icon>
          </button>
          @if (registroForm.get('password')?.hasError('required') &&
          registroForm.get('password')?.touched) {
          <mat-error>Senha é obrigatória</mat-error>
          } @if (registroForm.get('password')?.hasError('minlength') &&
          registroForm.get('password')?.touched) {
          <mat-error>Senha deve ter pelo menos 6 caracteres</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Endereço -->
      <div class="form-section" formGroupName="localidade">
        <h3>Endereço</h3>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>CEP</mat-label>
          <input
            matInput
            formControlName="cep"
            placeholder="00000-000"
            mask="00000-000"
            (blur)="buscarCep()"
          />
          <mat-icon matSuffix>place</mat-icon>
          @if (registroForm.get('localidade.cep')?.hasError('required') &&
          registroForm.get('localidade.cep')?.touched) {
          <mat-error>CEP é obrigatório</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Endereço</mat-label>
          <input
            matInput
            formControlName="endereco"
            placeholder="Rua, número"
          />
          <mat-icon matSuffix>home</mat-icon>
          @if (registroForm.get('localidade.endereco')?.hasError('required') &&
          registroForm.get('localidade.endereco')?.touched) {
          <mat-error>Endereço é obrigatório</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Ponto de Referência</mat-label>
          <input
            matInput
            formControlName="referencia"
            placeholder="Próximo ao shopping, etc."
          />
          <mat-icon matSuffix>location_on</mat-icon>
        </mat-form-field>
      </div>

      @if (errorMessage()) {
      <div class="error-message">
        <mat-icon>error</mat-icon>
        <span>{{ errorMessage() }}</span>
      </div>
      } @if (successMessage()) {
      <div class="success-message">
        <mat-icon>check_circle</mat-icon>
        <span>{{ successMessage() }}</span>
      </div>
      }

      <button
        mat-raised-button
        color="accent"
        type="submit"
        class="registro-button"
        [disabled]="registroForm.invalid || loading()"
      >
        @if (loading()) {
        <mat-spinner diameter="20"></mat-spinner>
        Criando conta... } @else { Criar Conta }
      </button>
    </form>

    <div class="registro-footer">
      <p>Já tem uma conta?</p>
      <a routerLink="/login" mat-button color="primary">Faça login aqui</a>
    </div>
  </div>
</div>
